<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carrito — CRONOX</title>
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="Carrito de compra CRONOX — Dark streetwear premium.">

  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml" />
  <link rel="alternate icon" href="assets/logo_browser.png" type="image/png" />
  <!-- CSS global -->
  <link rel="stylesheet" href="assets/store.css?v=58" />
  <!-- CSS del carrito (nuevo) -->
  <link rel="stylesheet" href="assets/cart.css?v=2" />
</head>
<body>

  <div id="overlay" class="overlay" hidden></div>

  <!-- Topbar opaca (igual que en producto/index) -->
  <header class="topbar topbar--page" id="topbar" role="banner">
    <div class="topbar__left">
      <button id="btnMenu" class="icon-btn" aria-label="Abrir filtros" aria-expanded="false" aria-controls="filtersPanel">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round" class="icon" aria-hidden="true" focusable="false">
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>

      <button id="btnSearch" class="icon-btn" aria-label="Buscar productos" aria-expanded="false" aria-controls="searchBar">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round" class="icon" aria-hidden="true" focusable="false">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </button>
    </div>

    <a href="index.html#store" class="topbar__logo" aria-label="CRONOX — Tienda">
      <img
        src="assets/logo_banner.png"
        alt="CRONOX"
        class="topbar__logo-img"
        decoding="async"
      >
    </a>

    <nav class="topbar__right" aria-label="Navegación principal">
      <a href="#" class="topbar__link topbar__profile" id="profileBtn" aria-label="Iniciar sesión" title="Iniciar sesión">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-user" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M4 21v-2a4 4 0 0 1 3-3.87"></path>
          <circle cx="12" cy="7.5" r="4"></circle>
        </svg>
      </a>

      <a href="favorites.html" class="topbar__link topbar__fav" aria-label="Ver favoritos">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-star" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="12 2 15.09 8.26 22 9.27 17.3 13.97 18.18 21 12 17.77 5.82 21 6.7 13.97 2 9.27 8.91 8.26 12 2"></polygon>
        </svg>
        <span class="fav-count" hidden>0</span>
      </a>

      <a href="cart.html" class="topbar__link topbar__cart" aria-label="Ver carrito" aria-current="page">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-bag" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
          <line x1="3" y1="6" x2="21" y2="6"/>
          <path d="M16 10a4 4 0 0 1-8 0"/>
        </svg>
        <span class="cart-count" aria-label="Artículos en el carrito" hidden>0</span>
      </a>
    </nav>
  </header>

  <!-- Barra de búsqueda (igual que en el resto) -->
  <div id="searchBar" class="searchbar" hidden aria-hidden="true">
    <div class="searchbar__inner">
      <form id="searchForm" class="searchbar__form" role="search" action="index.html#store">
        <input id="searchInput" class="searchbar__input" type="text" placeholder="Buscar productos…" autocomplete="off" />
        <button class="searchbar__submit" type="submit" aria-label="Buscar"><span>Buscar</span></button>
      </form>
      <button type="button" class="searchbar__close" aria-label="Cerrar búsqueda">×</button>
    </div>
  </div>

  <!-- Menú lateral reutilizado (igual que en index/producto) -->
  <aside id="filtersPanel" class="black-menu" hidden aria-label="Navegación de categorías" role="dialog" aria-modal="true">
    <button class="filters-close" aria-label="Cerrar menú">✕</button>
    <nav class="black-menu__list" role="menu">
      <a class="black-menu__link" role="menuitem" href="tienda.html">Toda la oscuridad</a>
      <a class="black-menu__link" role="menuitem" href="tienda-camisetas.html">Camisetas</a>
      <a class="black-menu__link" role="menuitem" href="tienda-sudaderas.html">Sudaderas</a>
      <a class="black-menu__link" role="menuitem" href="tienda-accesorios.html">Accesorios</a>
    </nav>
  </aside>

  <!-- CONTENIDO DEL CARRITO -->
  <main id="cartMain" class="cart container" aria-live="polite">
    <h1 class="cart__title">Tu carrito</h1>

    <div class="cart-grid">
      <!-- Lista de productos -->
      <section id="cartItems" class="cart-items" aria-label="Productos en el carrito">
        <!-- Cada ítem -->
        <!-- Tu script existente puede rellenar aquí; dejo estructura base por si acaso -->
        <div class="cart-item empty" data-empty hidden>
          <p>Tu carrito está vacío.</p>
          <p><a href="index.html#store" class="btn-link">Seguir comprando →</a></p>
        </div>
      </section>

      <!-- Resumen / Pago (APILADO DEBAJO EN MÓVIL) -->
      <aside id="cartSummary" class="cart-summary" aria-label="Resumen y pago">
        <h2>Resumen</h2>

        <div class="summary-row">
          <span>Subtotal</span>
          <strong id="sumSubtotal">—</strong>
        </div>
        <div class="summary-row">
          <span>Envío</span>
          <span id="sumShipping">Calculado en checkout</span>
        </div>
        <div class="summary-row summary-total">
          <span>Total</span>
          <strong id="sumTotal">—</strong>
        </div>

        <!-- Botón de pago -->
        <button id="btnCheckout" class="btn-primary btn-block">Ir a pagar</button>

        <!-- Opcional: métodos/seguridad -->
        <div class="pay-trust">
          <span>Pago seguro</span>
          <ul>
            <li>Tarjeta</li>
            <li>PayPal</li>
            <li>Apple/Google Pay</li>
          </ul>
        </div>
      </aside>
    </div>
  </main>

  <footer class="footer">
    <div class="container">© <span id="anio"></span> CRONOX</div>
  </footer>

  <!-- JS (reutiliza tus scripts) -->
  <script>
    document.getElementById('anio').textContent = new Date().getFullYear();

    // === Render mínimo por si no tienes un cart.js dedicado ===
    // Lee 'cronox_cart' y pinta items. Si ya tienes tu propio render, puedes borrar esto.
    (function(){
      const key = "cronox_cart";
      const itemsEl = document.getElementById("cartItems");
      if (!itemsEl) return;
      let cart = [];
      try { cart = JSON.parse(localStorage.getItem(key) || "[]"); } catch {}
      itemsEl.innerHTML = "";

      if (!cart.length) {
        const empty = document.querySelector(".cart-item.empty");
        if (empty) empty.hidden = false;
        updateSummary(0);
        return;
      }

      let subtotal = 0;
      const frag = document.createDocumentFragment();

      cart.forEach((it, i) => {
        const li = document.createElement("article");
        li.className = "cart-item";
        li.innerHTML = `
          <div class="ci-media">
            <img src="${it.image}" alt="${it.name || "Producto"}" loading="lazy">
          </div>
          <div class="ci-info">
            <h3 class="ci-name">${it.name || ""}</h3>
            <p class="ci-meta">
              ${it.color ? `<span>Color: ${String(it.color).toUpperCase()}</span>` : ""}
              ${it.size ? `<span>Talla: ${String(it.size).toUpperCase()}</span>` : ""}
            </p>
            <div class="ci-controls">
              <label>Cant.
                <input type="number" class="ci-qty" min="1" value="${it.qty || 1}" data-idx="${i}">
              </label>
              <button class="ci-remove" data-idx="${i}">Eliminar</button>
            </div>
          </div>
          <div class="ci-price">
            <span>${it.priceLabel || (Number(it.price)||0).toLocaleString("es-ES",{style:"currency",currency:"EUR"})}</span>
          </div>
        `;
        subtotal += (Number(it.price)||0) * (Number(it.qty)||1);
        frag.appendChild(li);
      });

      itemsEl.appendChild(frag);
      updateSummary(subtotal);

      // qty change
      itemsEl.addEventListener("change", (e) => {
        const inp = e.target.closest(".ci-qty");
        if (!inp) return;
        const idx = Number(inp.dataset.idx);
        const val = Math.max(1, parseInt(inp.value||"1", 10));
        cart[idx].qty = val;
        localStorage.setItem(key, JSON.stringify(cart));
        // recalcular
        let st = 0;
        cart.forEach(it => st += (Number(it.price)||0) * (Number(it.qty)||1));
        updateSummary(st);
        window.dispatchEvent(new Event("cart:updated"));
      });

      // remove
      itemsEl.addEventListener("click", (e) => {
        const btn = e.target.closest(".ci-remove");
        if (!btn) return;
        const idx = Number(btn.dataset.idx);
        cart.splice(idx,1);
        localStorage.setItem(key, JSON.stringify(cart));
        location.reload();
      });

      function updateSummary(subtotal){
        const f = (n)=> new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(n||0);
        document.getElementById("sumSubtotal").textContent = f(subtotal);
        document.getElementById("sumTotal").textContent = f(subtotal); // sin tasas/envío en este paso
      }
    })();
  </script>

  <script src="assets/app.js?v=48" defer></script>
  <script src="assets/cart-badge.js?v=31" defer></script>
</body>
</html>
